<script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyA2qs90lKafa6olFniAv6FnDTpK9T_RUEQ"></script>
<script src="/storage/assets/plugin/googlemaps/js-marker-clusterer-gh-pages/src/markerclusterer_compiled.js"></script>

<script>
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('7 8(a){a=a||{};r.s.1R.2k(2,3d);2.Q=a.1v||"";2.1H=a.1B||J;2.S=a.1G||0;2.H=a.1z||1h r.s.1Y(0,0);2.B=a.U||1h r.s.2E(0,0);2.15=a.13||t;2.1p=a.1t||"2h";2.1m=a.F||{};2.1E=a.1C||"3g";2.P=a.1j||"3b://38.r.33/2Y/2T/2N/1r.2K";3(a.1j===""){2.P=""}2.1f=a.1x||1h r.s.1Y(1,1);3(q a.A==="p"){3(q a.18==="p"){a.A=L}v{a.A=!a.18}}2.w=!a.A;2.17=a.1n||J;2.1I=a.2g||"2e";2.16=a.1l||J;2.4=t;2.z=t;2.14=t;2.V=t;2.E=t;2.R=t}8.9=1h r.s.1R();8.9.25=7(){5 i;5 f;5 a;5 d=2;5 c=7(e){e.20=L;3(e.1i){e.1i()}};5 b=7(e){e.30=J;3(e.1Z){e.1Z()}3(!d.16){c(e)}};3(!2.4){2.4=1e.2S("2Q");2.1d();3(q 2.Q.1u==="p"){2.4.O=2.G()+2.Q}v{2.4.O=2.G();2.4.1a(2.Q)}2.2J()[2.1I].1a(2.4);2.1w();3(2.4.6.D){2.R=L}v{3(2.S!==0&&2.4.Z>2.S){2.4.6.D=2.S;2.4.6.2D="2A";2.R=L}v{a=2.1P();2.4.6.D=(2.4.Z-a.W-a.11)+"12";2.R=J}}2.1F(2.1H);3(!2.16){2.E=[];f=["2t","1O","2q","2p","1M","2o","2n","2m","2l"];1o(i=0;i<f.1L;i++){2.E.1K(r.s.u.19(2.4,f[i],c))}2.E.1K(r.s.u.19(2.4,"1O",7(e){2.6.1J="2j"}))}2.V=r.s.u.19(2.4,"2i",b);r.s.u.T(2,"2f")}};8.9.G=7(){5 a="";3(2.P!==""){a="<2d";a+=" 2c=\'"+2.P+"\'";a+=" 2b=11";a+=" 6=\'";a+=" U: 2a;";a+=" 1J: 29;";a+=" 28: "+2.1E+";";a+="\'>"}K a};8.9.1w=7(){5 a;3(2.P!==""){a=2.4.3n;2.z=r.s.u.19(a,"1M",2.27())}v{2.z=t}};8.9.27=7(){5 a=2;K 7(e){e.20=L;3(e.1i){e.1i()}r.s.u.T(a,"3m");a.1r()}};8.9.1F=7(d){5 m;5 n;5 e=0,I=0;3(!d){m=2.1D();3(m 3l r.s.3k){3(!m.26().3h(2.B)){m.3f(2.B)}n=m.26();5 a=m.3e();5 h=a.Z;5 f=a.24;5 k=2.H.D;5 l=2.H.1k;5 g=2.4.Z;5 b=2.4.24;5 i=2.1f.D;5 j=2.1f.1k;5 o=2.23().3c(2.B);3(o.x<(-k+i)){e=o.x+k-i}v 3((o.x+g+k+i)>h){e=o.x+g+k+i-h}3(2.17){3(o.y<(-l+j+b)){I=o.y+l-j-b}v 3((o.y+l+j)>f){I=o.y+l+j-f}}v{3(o.y<(-l+j)){I=o.y+l-j}v 3((o.y+b+l+j)>f){I=o.y+b+l+j-f}}3(!(e===0&&I===0)){5 c=m.3a();m.39(e,I)}}}};8.9.1d=7(){5 i,F;3(2.4){2.4.37=2.1p;2.4.6.36="";F=2.1m;1o(i 35 F){3(F.34(i)){2.4.6[i]=F[i]}}2.4.6.32="31(0)";3(q 2.4.6.X!=="p"&&2.4.6.X!==""){2.4.6.2Z="\\"2X:2W.2V.2U(2R="+(2.4.6.X*1X)+")\\"";2.4.6.2P="2O(X="+(2.4.6.X*1X)+")"}2.4.6.U="2M";2.4.6.M=\'1c\';3(2.15!==t){2.4.6.13=2.15}}};8.9.1P=7(){5 c;5 a={1b:0,1g:0,W:0,11:0};5 b=2.4;3(1e.1s&&1e.1s.1W){c=b.2L.1s.1W(b,"");3(c){a.1b=C(c.1V,10)||0;a.1g=C(c.1U,10)||0;a.W=C(c.1T,10)||0;a.11=C(c.1S,10)||0}}v 3(1e.2I.N){3(b.N){a.1b=C(b.N.1V,10)||0;a.1g=C(b.N.1U,10)||0;a.W=C(b.N.1T,10)||0;a.11=C(b.N.1S,10)||0}}K a};8.9.2H=7(){3(2.4){2.4.2G.2F(2.4);2.4=t}};8.9.1y=7(){2.25();5 a=2.23().2C(2.B);2.4.6.W=(a.x+2.H.D)+"12";3(2.17){2.4.6.1g=-(a.y+2.H.1k)+"12"}v{2.4.6.1b=(a.y+2.H.1k)+"12"}3(2.w){2.4.6.M="1c"}v{2.4.6.M="A"}};8.9.2B=7(a){3(q a.1t!=="p"){2.1p=a.1t;2.1d()}3(q a.F!=="p"){2.1m=a.F;2.1d()}3(q a.1v!=="p"){2.1Q(a.1v)}3(q a.1B!=="p"){2.1H=a.1B}3(q a.1G!=="p"){2.S=a.1G}3(q a.1z!=="p"){2.H=a.1z}3(q a.1n!=="p"){2.17=a.1n}3(q a.U!=="p"){2.1q(a.U)}3(q a.13!=="p"){2.22(a.13)}3(q a.1C!=="p"){2.1E=a.1C}3(q a.1j!=="p"){2.P=a.1j}3(q a.1x!=="p"){2.1f=a.1x}3(q a.18!=="p"){2.w=a.18}3(q a.A!=="p"){2.w=!a.A}3(q a.1l!=="p"){2.16=a.1l}3(2.4){2.1y()}};8.9.1Q=7(a){2.Q=a;3(2.4){3(2.z){r.s.u.Y(2.z);2.z=t}3(!2.R){2.4.6.D=""}3(q a.1u==="p"){2.4.O=2.G()+a}v{2.4.O=2.G();2.4.1a(a)}3(!2.R){2.4.6.D=2.4.Z+"12";3(q a.1u==="p"){2.4.O=2.G()+a}v{2.4.O=2.G();2.4.1a(a)}}2.1w()}r.s.u.T(2,"2z")};8.9.1q=7(a){2.B=a;3(2.4){2.1y()}r.s.u.T(2,"21")};8.9.22=7(a){2.15=a;3(2.4){2.4.6.13=a}r.s.u.T(2,"2y")};8.9.2x=7(a){2.w=!a;3(2.4){2.4.6.M=(2.w?"1c":"A")}};8.9.2w=7(){K 2.Q};8.9.1A=7(){K 2.B};8.9.2v=7(){K 2.15};8.9.2u=7(){5 a;3((q 2.1D()==="p")||(2.1D()===t)){a=J}v{a=!2.w}K a};8.9.3i=7(){2.w=J;3(2.4){2.4.6.M="A"}};8.9.3j=7(){2.w=L;3(2.4){2.4.6.M="1c"}};8.9.2s=7(c,b){5 a=2;3(b){2.B=b.1A();2.14=r.s.u.2r(b,"21",7(){a.1q(2.1A())})}2.1N(c);3(2.4){2.1F()}};8.9.1r=7(){5 i;3(2.z){r.s.u.Y(2.z);2.z=t}3(2.E){1o(i=0;i<2.E.1L;i++){r.s.u.Y(2.E[i])}2.E=t}3(2.14){r.s.u.Y(2.14);2.14=t}3(2.V){r.s.u.Y(2.V);2.V=t}2.1N(t)};',62,210,'||this|if|div_|var|style|function|InfoBox|prototype||||||||||||||||undefined|typeof|google|maps|null|event|else|isHidden_|||closeListener_|visible|position_|parseInt|width|eventListeners_|boxStyle|getCloseBoxImg_|pixelOffset_|yOffset|false|return|true|visibility|currentStyle|innerHTML|closeBoxURL_|content_|fixedWidthSet_|maxWidth_|trigger|position|contextListener_|left|opacity|removeListener|offsetWidth||right|px|zIndex|moveListener_|zIndex_|enableEventPropagation_|alignBottom_|isHidden|addDomListener|appendChild|top|hidden|setBoxStyle_|document|infoBoxClearance_|bottom|new|stopPropagation|closeBoxURL|height|enableEventPropagation|boxStyle_|alignBottom|for|boxClass_|setPosition|close|defaultView|boxClass|nodeType|content|addClickHandler_|infoBoxClearance|draw|pixelOffset|getPosition|disableAutoPan|closeBoxMargin|getMap|closeBoxMargin_|panBox_|maxWidth|disableAutoPan_|pane_|cursor|push|length|click|setMap|mouseover|getBoxWidths_|setContent|OverlayView|borderRightWidth|borderLeftWidth|borderBottomWidth|borderTopWidth|getComputedStyle|100|Size|preventDefault|cancelBubble|position_changed|setZIndex|getProjection|offsetHeight|createInfoBoxDiv_|getBounds|getCloseClickHandler_|margin|pointer|relative|align|src|img|floatPane|domready|pane|infoBox|contextmenu|default|apply|touchmove|touchend|touchstart|dblclick|mouseup|mouseout|addListener|open|mousedown|getVisible|getZIndex|getContent|setVisible|zindex_changed|content_changed|auto|setOptions|fromLatLngToDivPixel|overflow|LatLng|removeChild|parentNode|onRemove|documentElement|getPanes|gif|ownerDocument|absolute|mapfiles|alpha|filter|div|Opacity|createElement|en_us|Alpha|Microsoft|DXImageTransform|progid|intl|MsFilter|returnValue|translateZ|WebkitTransform|com|hasOwnProperty|in|cssText|className|www|panBy|getCenter|http|fromLatLngToContainerPixel|arguments|getDiv|setCenter|2px|contains|show|hide|Map|instanceof|closeclick|firstChild'.split('|'),0,{}))
var styles = [[{
  url: '/storage/assets/plugin/googlemaps/js-marker-clusterer-gh-pages/images/m1.png',
  height: 52,
  width: 53,
  anchor: [8, 0],
  textColor: '#ff00ff',
  textSize: 10
}, {
  url: '/storage/assets/plugin/googlemaps/js-marker-clusterer-gh-pages/images/m2.png',
  height: 56,
  width: 55,
  anchor: [9, 0],
  textColor: '#ff0000',
  textSize: 11
}, {
  url: '/storage/assets/plugin/googlemaps/js-marker-clusterer-gh-pages/images/m3.png',
  height: 66,
  width: 65,
  anchor: [10, 0],
  textColor: '#ff0000',
  textSize: 11
}, {
  url: '/storage/assets/plugin/googlemaps/js-marker-clusterer-gh-pages/images/m4.png',
  height: 78,
  width: 77,
  anchor: [11, 0],
  textColor: '#ff0000',
  textSize: 11
}, {
  url: '/storageassets/plugin/googlemaps/js-marker-clusterer-gh-pages/images/m5.png',
  width: 89,
  height: 90,
  anchor: [12, 0],
  textSize: 12
}]];

var markerClusterer = null;
var map;
var infoWindow;
var imageUrl = 'https://chart.apis.google.com/chart?cht=mm&chs=24x32&chco=FFFFFF,008CFF,000000&ext=.png';
//var image_type = $('[name=yoyaku-type] option:selected').val();
//var image_type = document.searchYoyakuForm.yoyaku-type.value;
//console.log(image_type);




var geocoder;
var map;
var markers = Array();
var infos = Array();

// clear overlays function
function clearOverlays() {
    if (markers) {
        for (i in markers) {
            markers[i].setMap(null);
        }
        markers = [];
        infos = [];
    }
}
// clear infos function
function clearInfos() {
    if (infos) {
        for (i in infos) {
            if (infos[i].getMap()) {
                infos[i].close();
            }
        }
    }
}

function deleteMarkers() {
    clearMarkers();
    markers = [];
}
function clearMarkers() {
    setMapOnAll(null);
}
function setMapOnAll(map) {
    for (var i = 0; i < markers.length; i++) {
        markers[i].setMap(map);
    }
}

function refreshMap(data) {

console.log(data);
  var net_yoyaku = false;
  var setPositionValue = null;
  if (markerClusterer) {
    markerClusterer.clearMarkers();
  }
  markers = [];

  var markerImage = new google.maps.MarkerImage(imageUrl, new google.maps.Size(24, 32));

  for (var i = 0; i < data.length; ++i) {
    if(data[i].content_date) net_yoyaku = true;
    
    if(i===0){
      setPositionValue = new google.maps.LatLng(data[i].latitude, data[i].longitude);
    }
    var latLng = new google.maps.LatLng(data[i].latitude, data[i].longitude);
    var marker = new google.maps.Marker({
      position: latLng,
      icon: markerImage,
      title: data[i].name
    });
    var fn = markerClickFunction(data[i], latLng);
    google.maps.event.addListener(marker, 'click', fn);
    markers.push(marker);
  }

  markerClusterer = new MarkerClusterer(map, markers, {
    maxZoom: 14,
    gridSize: 40,
    styles: styles[0]
  });
  
  if(setPositionValue){
    map.setCenter(setPositionValue);
    $('#loading').hide();
  }

  if(net_yoyaku){
    document.getElementById('pageInfo').style.display = 'none';
  }else{
    document.getElementById('pageInfo').style.display = '';
  }

}

function initialize() {

  $( '#inputSearch' ).keypress( function ( e ) {
    if ( e.which == 13 ) {
      searchGoogleMapItems();
      return false;
    }
  });

  latlngNavigator = new google.maps.LatLng({!!$site_latlon!!});

  map = new google.maps.Map(document.getElementById('map'), {
    zoom: {!!$zoom!!},
    center: latlngNavigator,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    scaleControl: true
  });
  infoWindow = new google.maps.InfoWindow({maxWidth: 180});

  <?php $param = strstr($_SERVER["REQUEST_URI"], '?'); ?>
  getMapItems('/SenMonTen/{!!$GLOBALS['yoyaku_type_name']!!}/map/json{!!$param!!}');
  $('#country-area').change(function(){
    deleteMarkers();
    var country_area_id = $('[name=country-area] option:selected').val();
    if(!country_area_id) country_area_id = 13;
    Cookies.set('country_area_id', country_area_id, { expires: 30 });
    Cookies.set('country_area_address_one_custom_id', 0, { expires: 30 });
    Cookies.set('country_area_address_two_custom_id', 0, { expires: 30 });
    getMapItems(
      '/SenMonTen/{!!$GLOBALS['yoyaku_type_name']!!}/map/json?yoyaku_type_tag_id={!!$GLOBALS['yoyaku_type_tag_id']!!}'
      +'&country_area_id={!!$GLOBALS['country_area_id']!!}'
      +'&country_area_address_one_custom_id=0'
      +'&country_area_address_two_custom_id=0'
    );
    //yoyakuHeaderUpdate(0,0);
  });
  $('#country-area-address-one-custom').change(function(){
    deleteMarkers();
    var country_area_address_one_custom_id = $('[name=country-area-address-one-custom] option:selected').val();
    if(!country_area_address_one_custom_id) country_area_address_one_custom_id = 0;
    Cookies.set('country_area_address_one_custom_id', country_area_address_one_custom_id, { expires: 30 });
    Cookies.set('country_area_address_two_custom_id', 0, { expires: 30 });
    getMapItems(
      '/SenMonTen/{!!$GLOBALS['yoyaku_type_name']!!}/map/json?yoyaku_type_tag_id={!!$GLOBALS['yoyaku_type_tag_id']!!}'
      +'&country_area_id={!!$GLOBALS['country_area_id']!!}'
      +'&country_area_address_one_custom_id='+country_area_address_one_custom_id
      +'&country_area_address_two_custom_id=0'
    );
    //yoyakuHeaderUpdate(country_area_address_one_custom_id,0);
  });
  $('#country-area-address-two-custom').change(function(){
    deleteMarkers();
    var country_area_address_one_custom_id = $('[name=country-area-address-one-custom] option:selected').val();
    var country_area_address_two_custom_id = $('[name=country-area-address-two-custom] option:selected').val();
    if(!country_area_address_two_custom_id) country_area_address_two_custom_id = 0;
    Cookies.set('country_area_address_two_custom_id', country_area_address_two_custom_id, { expires: 30 });
    getMapItems(
      '/SenMonTen/{!!$GLOBALS['yoyaku_type_name']!!}/map/json?yoyaku_type_tag_id={!!$GLOBALS['yoyaku_type_tag_id']!!}'
      +'&country_area_id={!!$GLOBALS['country_area_id']!!}'
      +'&country_area_address_one_custom_id='+country_area_address_one_custom_id
      +'&country_area_address_two_custom_id='+country_area_address_two_custom_id
    );
    //yoyakuHeaderUpdate(country_area_address_one_custom_id,country_area_address_two_custom_id);
  });



  function yoyakuHeaderUpdate(country_area_address_one_custom_id,country_area_address_two_custom_id){

    var url = '/SenMonTen/{!!$GLOBALS['yoyaku_type_name']!!}/yoyakuHeaderUpdate'
        + '?yoyaku_type_tag_id={!!$GLOBALS['yoyaku_type_tag_id']!!}'
        + '&country_area_id={!!$GLOBALS['country_area_id']!!}'
        + '&country_area_address_one_custom_id='+country_area_address_one_custom_id
        + '&country_area_address_two_custom_id='+country_area_address_two_custom_id;

    axios.get(url)
    .then(function (response) {
      result = response.data;
      if(!ajaxCheckPublic(result)){return;}

      var country_area_address_one
        = '<a href="/SenMonTen/{!!$GLOBALS['yoyaku_type_name']!!}/map?country_area_id={!!$GLOBALS['country_area_id']!!}&country_area_address_one_custom_id='+country_area_address_one_custom_id+'"><strong class="f14 text-blue-grey-600">市区：</strong><strong class="f14">'
        +result.search_country_area_address_one_name
        +'</strong></a>';
      $('#search_country_area_address_one_name').html(country_area_address_one);

      var country_area_address_two = '<a href="/SenMonTen/{!!$GLOBALS['yoyaku_type_name']!!}/map?country_area_id={!!$GLOBALS['country_area_id']!!}&country_area_address_one_custom_id='+country_area_address_one_custom_id+'&country_area_address_two_custom_id='+country_area_address_two_custom_id+'"><strong class="f14 text-blue-grey-600">町村：</strong><strong class="f14">'
        +result.search_country_area_address_two_name
        +'</strong></a>';
      $('#search_country_area_address_two_name').html(country_area_address_two);

      $('.popbox .box').hide();
      refreshMap(result);
    })
    .catch(function (error) {
      $('.popbox .box').hide();
      ajaxCheckError(error); return;
    });

  }

  document.getElementById( 'findContents' ).onclick = function( e )
  {
      findContents();
  };
  function findContents(){
  
      var inputSearch = $('#search-name').val();
      //console.log(inputSearch);
      if(!inputSearch){
          $('#loading').hide();
          return;
      }   
      getMapItemsByName(inputSearch);
  
  }
  



  function getMapItemsByName(inputSearch){
    loading();
    axios.get('/SenMonTen/{!!$GLOBALS['yoyaku_type_name']!!}/map/json', {
      params: {
        searchWords: inputSearch,
      }
    })
    .then(function (response) {
      result = response.data;
      if(!ajaxCheckPublic(result)){return;}
      //console.log(result);
      if(result.length===0){
        $('#loading').hide();
        infoNotify('見つかりませんでした。');
      }
      $('.popbox .box').hide();
      refreshMap(result);
    })
    .catch(function (error) {
      $('.popbox .box').hide();
      ajaxCheckError(error); return;
    });
  };

  function getMapItems(url){
    loading();
    axios.get(url)
    .then(function (response) {
      result = response.data;
      if(!ajaxCheckPublic(result)){return;}
      if(result.length===0){
        $('#loading').hide();
        infoNotify('見つかりませんでした。');
      }
      $('.popbox .box').hide();
      refreshMap(result);
    })
    .catch(function (error) {
      $('.popbox .box').hide();
      ajaxCheckError(error); return;
    });
  };

  google.maps.event.addListener(map, 'click', function() {
    infoWindow.close();
  });

};


function markerClickFunction(data, latlng) {

  var valTypes = '';
  var placePic = '';
  var website = '';
  var open_close = 0;
  var shop_close = 0;
  var international_phone_number = '';

  return function(e) {
    e.cancelBubble = true;
    e.returnValue = false;

    //var name = obj.name;
    //var formatted_address = obj.formatted_address;
    var url = null;

    content = '<div id="iw-container ml-2">';
    content += '<div class="iw-content row">';
    content += '<div class="col-sm-5"><a href="/SenMonTen/{!!$GLOBALS['yoyaku_type_name']!!}/contents/'+data.id+'/desc"><img style="max-height:60px !important; max-width: 60px !important" class="" src="';
    if(data.pic){
        content += '/storage/uploads/contents/'+data.id+'/'+add_filename(data.pic,'250');
    }else{
        content += '/storage/global/img/{!!$GLOBALS['yoyaku_type_key']!!}'+Math.floor(Math.random() * 10) + 1;+'_250.jpeg';
    }
    content += '" /></a></div>';
    content += '<div class="col-sm-7 pl-0 center"><a href="/SenMonTen/{!!$GLOBALS['yoyaku_type_name']!!}/contents/'+data.id+'/desc"><span class="f13 text-success">' + data.name + '</span></a><br />';
    content += '<span>';
    content += recommend_star(data.recommend_point, '11');
    content += '</span>';
    content += ' <span class="f11">：' + data.recommend_number + '件</span>' ;
    if(data.tell){
      content += '<br /><span class="f11">' + data.tell + '</span>' ;
    }
    if(data.latitude){
      content += '<br /><a class="text-blue-500" href="https://maps.google.com/maps?q='+data.latitude+','+data.longitude+'" target="_blank" >マップ</a>' ;
    }
    content += '</div>';

    content += '<div class="col-sm-12 pt-4"><p class="center">';
    if(data.homepage){
      content += '<a class="f11" href="' + data.homepage + '">WEBSITE</a><br />';
    }
    content += '<span class="f11">' + data.address + '</span><br />';
    if(data.station_name){
      content += '<span class="f11 text-blue-grey-500"><strong>最寄駅：'+data.station_name+'('+data.station_distance+'m)</strong></span>';
    }else{
      content += '<span class="f11 text-blue-grey-500"><strong>最寄駅遠い。車がお勧め！</strong></span>';
    }
    content += '</p>';
    if(data.content_date){
      content += '<div class="center">';
      content += '<span class="f11 pr-2">'+getDayJp(data.content_date.start)+'</span>';
      content += '<span class="f11">'+moment(data.content_date.start).format('H:i')+' ~ <strong class="f11" style="color: '+data.content_date.color+'" >'+data.content_date.title+'</strong></span>';
      content += '</div>';
    }

    if(data.description){
      content += '<p class="text-blue-grey-700">';
      content += truncate(data.description, 100);
      content += '<br /><span>' + data.tell + '</span>' ;
      content += '</p>';
    }
          
    content += '</p></div>';

    content += '<div class="iw-bottom-gradient"></div>';
    content += '</div></div>';

    infoWindow.setContent(content);
    infoWindow.setPosition(new google.maps.LatLng( data.latitude, data.longitude ));

    infoWindow.open(map);

  };

};








function changeTimeStamp(ts){
  var d = new Date( ts * 1000 );
  var year  = d.getFullYear();
  var month = d.getMonth() + 1;
  var day  = d.getDate();
  var hour = ( d.getHours()   < 10 ) ? '0' + d.getHours()   : d.getHours();
  var min  = ( d.getMinutes() < 10 ) ? '0' + d.getMinutes() : d.getMinutes();
  var sec   = ( d.getSeconds() < 10 ) ? '0' + d.getSeconds() : d.getSeconds();
  var a = year + '-' + month + '-' + day + ' ' + hour + ':' + min;
  return a;
}
google.maps.event.addDomListener(window, 'load', initialize);

</script>